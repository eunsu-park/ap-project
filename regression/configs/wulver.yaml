# Enhanced Multi-Modal Model Configuration
# Configuration for transformer + ConvLSTM + CrossModalFusion architecture

defaults:
  - _self_
  - override hydra/job_logging: none
  - override hydra/hydra_logging: none

hydra:
  output_subdir: null
  run:
    dir: .
  job:
    chdir: false

environment:
  seed: 250104
  device: 'cuda'
  data_root: '/mmfs1/home/hl545/ap/data/datasets'
  save_root: '/mmfs1/home/hl545/ap/results'

experiment:
  experiment_name: 'wulver_default'
  phase: 'train'  # 'train' or 'validation'
  batch_size: 1
  num_workers: 0
  
  # Sampling strategies
  enable_undersampling: false
  num_subsample: 10
  subsample_index: 0
  
  enable_oversampling: true
  num_oversample: 13

data:
  dataset_name: 'three_twelve_to_one'
  
  # SDO (image) configuration
  sdo_wavelengths:
    - '193'
    - '211'
    - 'magnetogram'
  sdo_image_size: 64
  sdo_sequence_length: 28
  
  # OMNI (time series) configuration
  input_variables:
    - 'Bx_GSE_GSM_nT'
    - 'By_GSM_nT'
    - 'Bz_GSM_nT'
    - 'B_Magnitude_of_Avg_Field_Vector_nT'
    - 'Plasma_Flow_Speed_km_s'
    - 'Proton_Density_n_cm3'
    - 'Proton_Temperature_K'
    - 'Kp_Index'
    - 'ap_Index_nT'
    - 'DST_Index_nT'
    - 'f10_7_Index_sfu'
    - 'Sunspot_Number_R'
  input_sequence_length: 56
  
  # Target configuration
  target_variables:
    - 'ap_Index_nT'
  target_sequence_length: 8
  target_day: 1
  
  # Split index for input/target separation
  split_index: 80

model:
  # Transformer configuration
  transformer_d_model: 256
  transformer_nhead: 8
  transformer_num_layers: 3
  transformer_dim_feedforward: 512
  transformer_dropout: 0.1

  # ConvLSTM configuration
  convlstm_input_channels: 3
  convlstm_hidden_channels: 64
  convlstm_kernel_size: 3
  convlstm_num_layers: 2

  # Cross-modal fusion configuration
  fusion_num_heads: 4
  fusion_dropout: 0.1

training:
  # Basic training parameters
  num_epochs: 1000
  learning_rate: 0.0002
  optimizer: 'adam'  # 'adam' or 'sgd'
  
  # Loss configuration
  loss_type: 'mse'  # 'mse' or 'mae'
  
  # Contrastive loss configuration
  contrastive_type: 'mse'  # 'mse' or 'infonce'
  contrastive_temperature: 0.3  # Only used if contrastive_type='infonce'
  lambda_contrastive: 0.1  # Weight for contrastive loss
  
  # Logging and checkpointing
  report_freq: 1000  # Report metrics every N batches
  model_save_freq: 100  # Save checkpoint every N epochs

validation:
  checkpoint_path: /home/hl545/ap/results/wulver_mm_class/checkpoint/model_epoch50.pth
  output_dir: /home/hl545/ap/results/wulver_mm_class/epoch_050
  compute_alignment: true  # Whether to compute feature alignment (cosine similarity)
  save_plots: true  # Whether to save individual validation plots